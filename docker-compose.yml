# docker-compose.yml

version: "3.8"

services:
  # 1. ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Database Service)
  db:
    image: postgres:14-alpine
    restart: always
    container_name: vulnshop_db
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: 1234
      POSTGRES_DB: vulnshop_db
    ports:
      - "5433:5432" # üëà External Port: 5433, Internal Port: 5432
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
      - db-data:/var/lib/postgresql/data

  # 2. ‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô (Next.js Service)
  web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: vulnshop_app
    ports:
      - "8888:3000" # üëà External Port: 8888, Internal Port: 3000
    volumes:
      - .:/app
      - /app/node_modules
    env_file:
      - .env
    depends_on:
      - db
    command: npm run dev # ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏±‡∏í‡∏ô‡∏≤ (Development Mode)
    # command: /bin/sh -c "npm run build && npm start" # ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏õ‡∏£‡∏î‡∏±‡∏Å‡∏ä‡∏±‡∏ô (Production Mode)

volumes:
  db-data:
